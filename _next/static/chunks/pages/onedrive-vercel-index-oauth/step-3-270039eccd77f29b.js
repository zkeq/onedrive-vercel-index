(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1598],{33850:function(e,r,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/onedrive-vercel-index-oauth/step-3",function(){return n(73519)}])},73519:function(e,r,n){"use strict";n.r(r),n.d(r,{__N_SSP:function(){return j},default:function(){return b}});var t=n(24354),s=n.n(t),i=n(4637),c=n(51667),o=n(40632),a=n(41999),l=n(59496),u=n(60385),d=n(4313),h=n(25566),f=n.n(h),p=n(62191),x=n(94875),m=n(84322),g=n(76886);function v(e,r,n,t,s,i,c){try{var o=e[i](c),a=o.value}catch(l){return void n(l)}o.done?r(a):Promise.resolve(a).then(t,s)}var j=!0;function b(e){var r=e.accessToken,n=e.expiryTime,t=e.refreshToken,h=e.error,j=e.description,b=e.errorUri,k=(0,a.useRouter)(),y=(0,l.useState)(n),w=y[0],N=y[1],_=(0,d.$G)().t;(0,l.useEffect)((function(){if(w){var e=setInterval((function(){N(w-1)}),1e3);return function(){return clearInterval(e)}}}),[w]);var S=(0,l.useState)((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Store tokens")})," ",(0,i.jsx)(u.G,{icon:"key"})]})),G=S[0],P=S[1],T=(0,l.useState)(!1),E=T[0],A=T[1],C=function(){var e,c=(e=s().mark((function e(){var c,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A(!1),P((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Storing tokens")})," ",(0,i.jsx)(g.H,{className:"ml-1 inline h-4 w-4 animate-spin"})]})),e.next=4,(0,m.h9)(r);case 4:if(c=e.sent,o=c.data,200===c.status){e.next=11;break}return A(!0),P((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Error validating identify, restart")})," ",(0,i.jsx)(u.G,{icon:"exclamation-circle"})]})),e.abrupt("return");case 11:if(o.userPrincipalName===f().userPrincipalName){e.next=15;break}return A(!0),P((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Do not pretend to be the site owner")})," ",(0,i.jsx)(u.G,{icon:"exclamation-circle"})]})),e.abrupt("return");case 15:return e.next=17,(0,m.o8)(r,t,n).then((function(){A(!1),P((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Stored! Going home...")})," ",(0,i.jsx)(u.G,{icon:"check"})]})),setTimeout((function(){k.push("/")}),2e3)})).catch((function(e){A(!0),P((0,i.jsxs)("div",{children:[(0,i.jsx)("span",{children:_("Error storing the token")})," ",(0,i.jsx)(u.G,{icon:"exclamation-circle"})]}))}));case 17:case"end":return e.stop()}}),e)})),function(){var r=this,n=arguments;return new Promise((function(t,s){var i=e.apply(r,n);function c(e){v(i,t,s,c,o,"next",e)}function o(e){v(i,t,s,c,o,"throw",e)}c(void 0)}))});return function(){return c.apply(this,arguments)}}();return(0,i.jsxs)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-white dark:bg-gray-900",children:[(0,i.jsx)(c.default,{children:(0,i.jsx)("title",{children:_("OAuth Step 3 - {{title}}",{title:f().title})})}),(0,i.jsxs)("main",{className:"flex w-full flex-1 flex-col bg-gray-50 dark:bg-gray-800",children:[(0,i.jsx)(p.Z,{}),(0,i.jsx)("div",{className:"mx-auto w-full max-w-5xl p-4",children:(0,i.jsxs)("div",{className:"rounded bg-white p-3 dark:bg-gray-900 dark:text-gray-100",children:[(0,i.jsx)("div",{className:"mx-auto w-52",children:(0,i.jsx)(o.default,{src:"/images/fabulous-celebration.png",width:912,height:912,alt:"fabulous celebration",priority:!0})}),(0,i.jsx)("h3",{className:"mb-4 text-center text-xl font-medium",children:_("Welcome to your new onedrive-vercel-index \ud83c\udf89")}),(0,i.jsx)("h3",{className:"mt-4 mb-2 text-lg font-medium",children:_("Step 3/3: Get access and refresh tokens")}),h?(0,i.jsxs)("div",{children:[(0,i.jsxs)("p",{className:"py-1 font-medium text-red-500",children:[(0,i.jsx)(u.G,{icon:"exclamation-circle",className:"mr-2"}),(0,i.jsx)("span",{children:_("Whoops, looks like we got a problem: {{error}}.",{error:_(h)})})]}),(0,i.jsx)("p",{className:"my-2 whitespace-pre-line rounded border border-gray-400/20 bg-gray-50 p-2 font-mono text-sm opacity-80 dark:bg-gray-800",children:_(j)}),b&&(0,i.jsx)("p",{children:(0,i.jsxs)(d.cC,{children:["Check out"," ",(0,i.jsx)("a",{href:b,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline dark:text-blue-500",children:"Microsoft's official explanation"})," ","on the error message."]})}),(0,i.jsx)("div",{className:"mb-2 mt-6 text-right",children:(0,i.jsxs)("button",{className:"rounded-lg bg-gradient-to-br from-red-500 to-orange-400 px-4 py-2.5 text-center text-sm font-medium text-white hover:bg-gradient-to-bl focus:ring-4 focus:ring-red-200 disabled:cursor-not-allowed disabled:grayscale dark:focus:ring-red-800",onClick:function(){k.push("/onedrive-vercel-index-oauth/step-1")},children:[(0,i.jsx)(u.G,{icon:"arrow-left"})," ",(0,i.jsx)("span",{children:_("Restart")})]})})]}):(0,i.jsxs)("div",{children:[(0,i.jsx)("p",{className:"py-1 font-medium",children:_("Success! The API returned what we needed.")}),(0,i.jsxs)("ol",{className:"py-1",children:[r&&(0,i.jsxs)("li",{children:[(0,i.jsx)(u.G,{icon:["far","check-circle"],className:"text-green-500"})," ",(0,i.jsxs)("span",{children:[_("Acquired access_token: "),(0,i.jsx)("code",{className:"font-mono text-sm opacity-80",children:"".concat(r.substring(0,60),"...")})]})]}),t&&(0,i.jsxs)("li",{children:[(0,i.jsx)(u.G,{icon:["far","check-circle"],className:"text-green-500"})," ",(0,i.jsxs)("span",{children:[_("Acquired refresh_token: "),(0,i.jsx)("code",{className:"font-mono text-sm opacity-80",children:"".concat(t.substring(0,60),"...")})]})]})]}),(0,i.jsxs)("p",{className:"py-1 text-sm font-medium text-teal-500",children:[(0,i.jsx)(u.G,{icon:"exclamation-circle",className:"mr-1"})," ",_("These tokens may take a few seconds to populate after you click the button below. ")+_("If you go back home and still see the welcome page telling you to re-authenticate, ")+_("revisit home and do a hard refresh.")]}),(0,i.jsx)("p",{className:"py-1",children:_("Final step, click the button below to store these tokens persistently before they expire after {{minutes}} minutes {{seconds}} seconds. ",{minutes:Math.floor(w/60),seconds:w-60*Math.floor(w/60)})+_("Don't worry, after storing them, onedrive-vercel-index will take care of token refreshes and updates after your site goes live.")}),(0,i.jsx)("div",{className:"mb-2 mt-6 text-right",children:(0,i.jsx)("button",{className:"rounded-lg bg-gradient-to-br px-4 py-2.5 text-center text-sm font-medium text-white hover:bg-gradient-to-bl focus:ring-4 ".concat(E?"from-red-500 to-orange-400 focus:ring-red-200 dark:focus:ring-red-800":"from-green-500 to-teal-300 focus:ring-green-200 dark:focus:ring-green-800"),onClick:C,children:G})})]})]})})]}),(0,i.jsx)(x.Z,{})]})}},84322:function(e,r,n){"use strict";n.d(r,{mD:function(){return x},Ux:function(){return m},h9:function(){return g},o8:function(){return j}});var t=n(24354),s=n.n(t),i=n(72698),c=n.n(i),o=n(30507),a=n.n(o),l=n(15748),u=n.n(l);function d(e,r,n,t,s,i,c){try{var o=e[i](c),a=o.value}catch(l){return void n(l)}o.done?r(a):Promise.resolve(a).then(t,s)}function h(e){return function(){var r=this,n=arguments;return new Promise((function(t,s){var i=e.apply(r,n);function c(e){d(i,t,s,c,o,"next",e)}function o(e){d(i,t,s,c,o,"throw",e)}c(void 0)}))}}var f="onedrive-vercel-index";function p(e){return a().AES.encrypt(e,f).toString()}function x(){var e=u().clientId,r=u().redirectUri,n=u().authApi,t=u().scope,s=n.replace("/token","/authorize"),i=new URLSearchParams;return i.append("client_id",e),i.append("redirect_uri",r),i.append("response_type","code"),i.append("scope",t),i.append("response_mode","query"),"".concat(s,"?").concat(i.toString())}function m(e){return e.startsWith(u().redirectUri)&&null!==(r=new URLSearchParams(e.split("?")[1]).get("code"))&&void 0!==r?r:"";var r}function g(e){return v.apply(this,arguments)}function v(){return(v=h(s().mark((function e(r){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=u().driveApi.replace("/drive",""),e.abrupt("return",c().get(n,{headers:{Authorization:"Bearer ".concat(r)}}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e,r,n){return b.apply(this,arguments)}function b(){return(b=h(s().mark((function e(r,n,t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c().post("/api",{obfuscatedAccessToken:p(r),accessTokenExpiry:parseInt(t),obfuscatedRefreshToken:p(n)},{headers:{"Content-Type":"application/json"}});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}}},function(e){e.O(0,[8857,507,3819,9774,2888,179],(function(){return r=33850,e(e.s=r);var r}));var r=e.O();_N_E=r}]);